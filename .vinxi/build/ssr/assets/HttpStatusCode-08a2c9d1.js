import{isServer as $,createComponent as O,spread as N,useAssets as x,ssr as w,escape as C,getRequestEvent as A}from"solid-js/web";import{createContext as L,createUniqueId as b,useContext as k,createRenderEffect as M,onCleanup as g,sharedConfig as D}from"solid-js";const T=L(),P=["title","meta"],f=[],h=["name","http-equiv","content","charset","media"].concat(["property"]),p=(t,n)=>{const e=Object.fromEntries(Object.entries(t.props).filter(([r])=>n.includes(r)).sort());return(Object.hasOwn(e,"name")||Object.hasOwn(e,"property"))&&(e.name=e.name||e.property,delete e.property),t.tag+JSON.stringify(e)};function S(){if(!D.context){const e=document.head.querySelectorAll("[data-sm]");Array.prototype.forEach.call(e,r=>r.parentNode.removeChild(r))}const t=new Map;function n(e){if(e.ref)return e.ref;let r=document.querySelector(`[data-sm="${e.id}"]`);return r?(r.tagName.toLowerCase()!==e.tag&&(r.parentNode&&r.parentNode.removeChild(r),r=document.createElement(e.tag)),r.removeAttribute("data-sm")):r=document.createElement(e.tag),r}return{addTag(e){if(P.indexOf(e.tag)!==-1){const i=e.tag==="title"?f:h,s=p(e,i);t.has(s)||t.set(s,[]);let o=t.get(s),l=o.length;o=[...o,e],t.set(s,o);let c=n(e);e.ref=c,N(c,e.props);let d=null;for(var r=l-1;r>=0;r--)if(o[r]!=null){d=o[r];break}return c.parentNode!=document.head&&document.head.appendChild(c),d&&d.ref&&document.head.removeChild(d.ref),l}let a=n(e);return e.ref=a,N(a,e.props),a.parentNode!=document.head&&document.head.appendChild(a),-1},removeTag(e,r){const a=e.tag==="title"?f:h,i=p(e,a);if(e.ref){const s=t.get(i);if(s){if(e.ref.parentNode){e.ref.parentNode.removeChild(e.ref);for(let o=r-1;o>=0;o--)s[o]!=null&&document.head.appendChild(s[o].ref)}s[r]=null,t.set(i,s)}else e.ref.parentNode&&e.ref.parentNode.removeChild(e.ref)}}}}function j(){const t=[];return x(()=>w(H(t))),{addTag(n){if(P.indexOf(n.tag)!==-1){const e=n.tag==="title"?f:h,r=p(n,e),a=t.findIndex(i=>i.tag===n.tag&&p(i,e)===r);a!==-1&&t.splice(a,1)}return t.push(n),t.length},removeTag(n,e){}}}const V=t=>{const n=$?j():S();return O(T.Provider,{value:n,get children(){return t.children}})},E=(t,n,e)=>(I({tag:t,props:n,setting:e,id:b(),get name(){return n.name||n.property}}),null);function I(t){const n=k(T);if(!n)throw new Error("<MetaProvider /> should be in the tree");M(()=>{const e=n.addTag(t);g(()=>n.removeTag(t,e))})}function H(t){return t.map(n=>{const r=Object.keys(n.props).map(i=>i==="children"?"":` ${i}="${C(n.props[i],!0)}"`).join(""),a=n.props.children;return n.setting?.close?`<${n.tag} data-sm="${n.id}"${r}>${n.setting?.escape?C(a):a||""}</${n.tag}>`:`<${n.tag} data-sm="${n.id}"${r}/>`}).join("")}const Y=t=>E("title",t,{escape:!0,close:!0}),B=t=>E("link",t),u={NORMAL:0,WILDCARD:1,PLACEHOLDER:2};function _(t={}){const n={options:t,rootNode:R(),staticRoutesMap:{}},e=r=>t.strictTrailingSlash?r:r.replace(/\/$/,"")||"/";if(t.routes)for(const r in t.routes)v(n,e(r),t.routes[r]);return{ctx:n,lookup:r=>q(n,e(r)),insert:(r,a)=>v(n,e(r),a),remove:r=>W(n,e(r))}}function q(t,n){const e=t.staticRoutesMap[n];if(e)return e.data;const r=n.split("/"),a={};let i=!1,s=null,o=t.rootNode,l=null;for(let c=0;c<r.length;c++){const d=r[c];o.wildcardChildNode!==null&&(s=o.wildcardChildNode,l=r.slice(c).join("/"));const m=o.children.get(d);if(m!==void 0)o=m;else if(o=o.placeholderChildNode,o!==null)a[o.paramName]=d,i=!0;else break}return(o===null||o.data===null)&&s!==null&&(o=s,a[o.paramName||"_"]=l,i=!0),o?i?{...o.data,params:i?a:void 0}:o.data:null}function v(t,n,e){let r=!0;const a=n.split("/");let i=t.rootNode,s=0;for(const o of a){let l;if(l=i.children.get(o))i=l;else{const c=K(o);l=R({type:c,parent:i}),i.children.set(o,l),c===u.PLACEHOLDER?(l.paramName=o==="*"?`_${s++}`:o.slice(1),i.placeholderChildNode=l,r=!1):c===u.WILDCARD&&(i.wildcardChildNode=l,l.paramName=o.slice(3)||"_",r=!1),i=l}}return i.data=e,r===!0&&(t.staticRoutesMap[n]=i),i}function W(t,n){let e=!1;const r=n.split("/");let a=t.rootNode;for(const i of r)if(a=a.children.get(i),!a)return e;if(a.data){const i=r[r.length-1];if(a.data=null,Object.keys(a.children).length===0){const s=a.parent;s.children.delete(i),s.wildcardChildNode=null,s.placeholderChildNode=null}e=!0}return e}function R(t={}){return{type:t.type||u.NORMAL,parent:t.parent||null,children:new Map,data:t.data||null,paramName:t.paramName||null,wildcardChildNode:null,placeholderChildNode:null}}function K(t){return t.startsWith("**")?u.WILDCARD:t[0]===":"||t==="*"?u.PLACEHOLDER:u.NORMAL}const y=[{$component:{src:"src/routes/index.tsx?pick=default&pick=$css",build:()=>import("../index.js"),import:()=>import("../index.js")},path:"/",filePath:"D:/Dev/traffic/src/routes/index.tsx"},{$component:{src:"src/routes/[...404].tsx?pick=default&pick=$css",build:()=>import("../_...404_.js"),import:()=>import("../_...404_.js")},path:"/*404",filePath:"D:/Dev/traffic/src/routes/[...404].tsx"}],Q=U(y.filter(t=>t.$component));function U(t){function n(e,r,a,i){const s=Object.values(e).find(o=>a.startsWith(o.id+"/"));return s?(n(s.children||(s.children=[]),r,a.slice(s.id.length)),e):(e.push({...r,id:a,path:a.replace(/\/\([^)/]+\)/g,"")}),e)}return t.sort((e,r)=>e.path.length-r.path.length).reduce((e,r)=>n(e,r,r.path,r.path),[])}function X(t,n){const e=F.lookup(t);if(e){const r=e.route[`$${n}`];return r===void 0?void 0:{handler:r,params:e.params}}}function z(t){return t.$GET||t.$POST||t.$PUT||t.$PATCH||t.$DELETE}const F=_({routes:y.reduce((t,n)=>{if(!z(n))return t;let e=n.path.replace(/\(.*\)\/?/g,"").replace(/\*([^/]*)/g,(r,a)=>`**:${a}`);if(/:[^/]*\?/g.test(e))throw new Error(`Optional parameters are not supported in API routes: ${e}`);if(t[e])throw new Error(`Duplicate API routes for "${e}" found at "${t[e].route.path}" and "${n.path}"`);return t[e]={route:n},t},{})});function Z(t){if($){const n=A();n.response.status=t.code,n.response.statusText=t.text,g(()=>!n.nativeEvent.handled&&(n.response.status=200))}return null}export{Z as H,B as L,V as M,Y as T,X as m,Q as p};
